# Avito_test

## Запуск

Сервис запускается с помощью docker-compose up

##### Запуск приложения
```
$ docker-compose up --build
```

После запуска сервера документация доступна по адресу http://127.0.0.1:8000/docs

##### Запуск тестов
```
$ docker-compose -f docker-compose.test.yml -p test_avito_test up --build --abort-on-container-exit
```
Может быть запущено как параллельно основному приложению, так и отдельно.


## План работы:
1. Создание репозитория, создание файлов README и gitignore
2. Проектирование и создание БД (PostgreSQL)
   * Написание скрипта для создания БД
3. Создание класса для доступа к БД
   * Функции создания голосования, голосования за вариант, получения результатов
4. Создание api класса (FastAPI)
   * Функции создания голосования, голосования за вариант, получения результатов
5. Написание тестов
6. Docker
7. Написание документации

## Схема архитектуры сервиса:
https://miro.com/app/board/o9J_l99xwVc=/

## Усложнения:
1. Для работы с большой нагрузкой необходимо использовать асинхронное подключение к БД. Так
   как скорее всего запросы создания голосования будут в порядка тысячи раз реже, чем 
   запросы на добавление голоса и получения результатов, то можно увеличить скорость обработки
   запросов путем создания зеркального KV-storage, которое будет содержать таблицу 
   `poll_id -> {choice_id -> vote_count}`. Получение результатов голосований будет производиться
   только с этой таблицы, что поможет разгрузить основную БД и будет быстрее за счет структуры
   KV-storage. Также необходимо несколько серверов с веб-сервисов и отдельный сервер с БД. Для 
   отказоустойчивости системы необходимо настроить репликацию баз данных.
   
   В самой БД необходимо ввести ограничение на количество вариантов в голосовании, длину названия 
   голосования и вариантов, ввести время жизни для голосований. При необходимости можно изменить
   тип poll_id с int на bigint или UUID.
2. 1. Запрет на голосование с одного и того же IP.
   2. Добавление обязательной регистрации.
   3. Использование уникальных заголовков.
   4. Бан известных прокси.   
   5. Определение геолокации.   
   6. Сильное изменение в динамике добавления голосов.
3. Сервис способен выдержать нагрузку порядка 40 RPS.